<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Android Code Samples | MAD9132</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Android App Development">
    
    <link rel="preload" href="/F2020/assets/css/0.styles.efac8754.css" as="style"><link rel="preload" href="/F2020/assets/js/app.1cc07ef2.js" as="script"><link rel="preload" href="/F2020/assets/js/2.4b4802b7.js" as="script"><link rel="preload" href="/F2020/assets/js/42.1e48655e.js" as="script"><link rel="prefetch" href="/F2020/assets/js/10.5106b495.js"><link rel="prefetch" href="/F2020/assets/js/11.6f05a404.js"><link rel="prefetch" href="/F2020/assets/js/12.4564ec2f.js"><link rel="prefetch" href="/F2020/assets/js/13.e666d981.js"><link rel="prefetch" href="/F2020/assets/js/14.f5622a69.js"><link rel="prefetch" href="/F2020/assets/js/15.e53f18da.js"><link rel="prefetch" href="/F2020/assets/js/16.145d8225.js"><link rel="prefetch" href="/F2020/assets/js/17.8962a051.js"><link rel="prefetch" href="/F2020/assets/js/18.49a4760c.js"><link rel="prefetch" href="/F2020/assets/js/19.b7a11f77.js"><link rel="prefetch" href="/F2020/assets/js/20.3d53d97a.js"><link rel="prefetch" href="/F2020/assets/js/21.74cfd594.js"><link rel="prefetch" href="/F2020/assets/js/22.c3a0ae4e.js"><link rel="prefetch" href="/F2020/assets/js/23.32772f69.js"><link rel="prefetch" href="/F2020/assets/js/24.8e7aa4b2.js"><link rel="prefetch" href="/F2020/assets/js/25.dec5c2d1.js"><link rel="prefetch" href="/F2020/assets/js/26.4ca24876.js"><link rel="prefetch" href="/F2020/assets/js/27.f8166d21.js"><link rel="prefetch" href="/F2020/assets/js/28.2e8ae410.js"><link rel="prefetch" href="/F2020/assets/js/29.c2905fd2.js"><link rel="prefetch" href="/F2020/assets/js/3.deb6ef4a.js"><link rel="prefetch" href="/F2020/assets/js/30.877f77ec.js"><link rel="prefetch" href="/F2020/assets/js/31.aca02277.js"><link rel="prefetch" href="/F2020/assets/js/32.df1c7dc6.js"><link rel="prefetch" href="/F2020/assets/js/33.e856014d.js"><link rel="prefetch" href="/F2020/assets/js/34.da644fc1.js"><link rel="prefetch" href="/F2020/assets/js/35.7a9a2b43.js"><link rel="prefetch" href="/F2020/assets/js/36.2066eacf.js"><link rel="prefetch" href="/F2020/assets/js/37.5f798923.js"><link rel="prefetch" href="/F2020/assets/js/38.9c77dfe5.js"><link rel="prefetch" href="/F2020/assets/js/39.eea97326.js"><link rel="prefetch" href="/F2020/assets/js/4.91154e50.js"><link rel="prefetch" href="/F2020/assets/js/40.73f7c5f0.js"><link rel="prefetch" href="/F2020/assets/js/41.635620bb.js"><link rel="prefetch" href="/F2020/assets/js/43.2607158f.js"><link rel="prefetch" href="/F2020/assets/js/44.3436507c.js"><link rel="prefetch" href="/F2020/assets/js/45.d69e3cc8.js"><link rel="prefetch" href="/F2020/assets/js/46.1bc68b3a.js"><link rel="prefetch" href="/F2020/assets/js/47.074c4315.js"><link rel="prefetch" href="/F2020/assets/js/48.6494ab96.js"><link rel="prefetch" href="/F2020/assets/js/49.25a8c66a.js"><link rel="prefetch" href="/F2020/assets/js/5.30a09b8e.js"><link rel="prefetch" href="/F2020/assets/js/50.a4d63146.js"><link rel="prefetch" href="/F2020/assets/js/51.40b83261.js"><link rel="prefetch" href="/F2020/assets/js/52.3ea8a189.js"><link rel="prefetch" href="/F2020/assets/js/6.256ed5d0.js"><link rel="prefetch" href="/F2020/assets/js/7.abbed4fb.js"><link rel="prefetch" href="/F2020/assets/js/8.941e2461.js"><link rel="prefetch" href="/F2020/assets/js/9.20225582.js">
    <link rel="stylesheet" href="/F2020/assets/css/0.styles.efac8754.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/F2020/" class="home-link router-link-active"><!----> <span class="site-name">MAD9132</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/F2020/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/F2020/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/F2020/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/F2020/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/F2020/assignments/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/F2020/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Content Modules</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/F2020/modules/install/" class="sidebar-link">Install Dev Tools</a></li><li><a href="/F2020/modules/submit/" class="sidebar-link">How to Submit Assignments</a></li><li><a href="/F2020/modules/template/" class="sidebar-link">Code Template</a></li><li><a href="/F2020/modules/kotlin-intro/" class="sidebar-link">Kotlin Introduction</a></li><li><a href="/F2020/modules/kotlin-oop/" class="sidebar-link">Kotlin OOP</a></li><li><a href="/F2020/modules/android/" class="sidebar-link">Android</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Deliverables</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="android-code-samples"><a href="#android-code-samples" class="header-anchor">#</a> Android Code Samples</h1> <h2 id="assignment-2"><a href="#assignment-2" class="header-anchor">#</a> Assignment 2</h2> <h3 id="permissions-and-dependencies"><a href="#permissions-and-dependencies" class="header-anchor">#</a> Permissions and Dependencies</h3> <p><code>AndroidManifest.xml</code></p> <p>Add the 2 uses-permission tags as shown below:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>application</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.permission.INTERNET<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.permission.ACCESS_NETWORK_STATE<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>manifest</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>build.gradle</code> (Module: app)</p> <p>Add these 2 dependencies as shown below:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dependencies {

    //..

    implementation 'com.github.bumptech.glide:glide:4.10.0'
    annotationProcessor 'com.github.bumptech.glide:compiler:4.10.0'
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="ui-and-resources"><a href="#ui-and-resources" class="header-anchor">#</a> UI and resources:</h3> <p>file: strings.xml</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app_name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Random Web Image<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>get_image_button_text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Get Image<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>image_description<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>A random web image<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message_title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Network Error<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message_text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>No internet connection<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ok<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>OK<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>retry<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Retry<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>quit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Quit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>file: <code>activity_main.xml</code></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ImageView</span>
<span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/imageView1<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0dp<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0dp<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">android:</span>layout_centerInParent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">android:</span>adjustViewBounds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">android:</span>contentDescription</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@string/image_description<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">android:</span>scaleType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fitCenter<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>parent<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>parent<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">app:</span>layout_constraintHorizontal_bias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.0<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>parent<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>parent<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">app:</span>layout_constraintVertical_bias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.0<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">tools:</span>srcCompat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@tools:sample/avatars<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>
<span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/getImageButton<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">android:</span>layout_marginBottom</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>36dp<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@string/get_image_button_text<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>parent<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>parent<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">app:</span>layout_constraintHorizontal_bias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0.493<span class="token punctuation">&quot;</span></span>
<span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>parent<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="glideimage-class"><a href="#glideimage-class" class="header-anchor">#</a> GlideImage Class</h3> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code><span class="token comment">// file: GlideImage.kt</span>

<span class="token keyword">import</span> android<span class="token punctuation">.</span>app<span class="token punctuation">.</span>Activity
<span class="token keyword">import</span> android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>ImageView
<span class="token keyword">import</span> com<span class="token punctuation">.</span>bumptech<span class="token punctuation">.</span>glide<span class="token punctuation">.</span>Glide
<span class="token keyword">import</span> com<span class="token punctuation">.</span>bumptech<span class="token punctuation">.</span>glide<span class="token punctuation">.</span>load<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>DiskCacheStrategy
<span class="token keyword">import</span> kotlin<span class="token punctuation">.</span>random<span class="token punctuation">.</span>Random

<span class="token keyword">class</span> GlideImage <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">val</span> listOfImageUrls <span class="token operator">=</span> mutableListOf<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">(</span>
        <span class="token string">&quot;Your Image URLs go here&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;There should be at least 10 of them&quot;</span><span class="token punctuation">,</span>

        <span class="token comment">//..</span>

        <span class="token string">&quot;last one&quot;</span>
    <span class="token punctuation">)</span>

    <span class="token keyword">private</span> <span class="token keyword">var</span> listCounter <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">var</span> lastURL <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
        <span class="token keyword">private</span> <span class="token keyword">set</span>

    <span class="token keyword">fun</span> <span class="token function">loadGlideImage</span><span class="token punctuation">(</span>
        imageView<span class="token operator">:</span> ImageView<span class="token punctuation">,</span>
        context<span class="token operator">:</span> Activity<span class="token punctuation">,</span>
        url<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token function">getRandomImageURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Glide<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token comment">// our context = the Activity</span>
                <span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">diskCacheStrategy</span><span class="token punctuation">(</span>DiskCacheStrategy<span class="token punctuation">.</span>ALL<span class="token punctuation">)</span> <span class="token comment">// All image data is loaded into cache = fast</span>
                <span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span>imageView<span class="token punctuation">)</span>

            lastURL <span class="token operator">=</span> url

    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">getRandomImageURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> String <span class="token punctuation">{</span>

        lastURL <span class="token operator">=</span> listOfImageUrls<span class="token punctuation">[</span>listCounter<span class="token punctuation">]</span>


        listCounter<span class="token operator">++</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>listCounter <span class="token operator">==</span> listOfImageUrls<span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            listOfImageUrls<span class="token punctuation">.</span><span class="token function">shuffle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            listCounter <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> lastURL
<span class="token punctuation">}</span>

    <span class="token keyword">init</span><span class="token punctuation">{</span>
        listOfImageUrls<span class="token punctuation">.</span><span class="token function">shuffle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><h3 id="mainactivity-kt"><a href="#mainactivity-kt" class="header-anchor">#</a> MainActivity.kt:</h3> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code><span class="token comment">// file: MainActivity.kt</span>

<span class="token keyword">import</span> android<span class="token punctuation">.</span>app<span class="token punctuation">.</span>AlertDialog
<span class="token keyword">import</span> android<span class="token punctuation">.</span>content<span class="token punctuation">.</span>Context
<span class="token keyword">import</span> android<span class="token punctuation">.</span>content<span class="token punctuation">.</span>res<span class="token punctuation">.</span>Configuration
<span class="token keyword">import</span> android<span class="token punctuation">.</span>net<span class="token punctuation">.</span>ConnectivityManager
<span class="token keyword">import</span> androidx<span class="token punctuation">.</span>appcompat<span class="token punctuation">.</span>app<span class="token punctuation">.</span>AppCompatActivity
<span class="token keyword">import</span> android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>Bundle
<span class="token keyword">import</span> androidx<span class="token punctuation">.</span>core<span class="token punctuation">.</span>view<span class="token punctuation">.</span>isVisible
<span class="token keyword">import</span> kotlinx<span class="token punctuation">.</span>android<span class="token punctuation">.</span>synthetic<span class="token punctuation">.</span>main<span class="token punctuation">.</span>activity_main<span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">import</span> kotlin<span class="token punctuation">.</span>random<span class="token punctuation">.</span>Random

<span class="token keyword">class</span> MainActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">val</span> glideImage <span class="token operator">=</span> <span class="token function">GlideImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkNetworkConnectivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            getImageButton<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                glideImage<span class="token punctuation">.</span><span class="token function">loadGlideImage</span><span class="token punctuation">(</span>imageView1<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>


            glideImage<span class="token punctuation">.</span><span class="token function">loadGlideImage</span><span class="token punctuation">(</span>imageView1<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">checkNetworkConnectivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>
        <span class="token keyword">val</span> cm <span class="token operator">=</span> <span class="token function">getSystemService</span><span class="token punctuation">(</span>Context<span class="token punctuation">.</span>CONNECTIVITY_SERVICE<span class="token punctuation">)</span> <span class="token keyword">as</span> ConnectivityManager
        <span class="token keyword">val</span> activeNetwork <span class="token operator">=</span> cm<span class="token punctuation">.</span>activeNetworkInfo
        <span class="token keyword">val</span> isConnected <span class="token operator">=</span> <span class="token punctuation">(</span>activeNetwork <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> activeNetwork<span class="token punctuation">.</span>isConnected<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isConnected<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            AlertDialog<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>message_title<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>message_text<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            getImageButton<span class="token punctuation">.</span>isEnabled <span class="token operator">=</span> <span class="token boolean">false</span>
            getImageButton<span class="token punctuation">.</span>isVisible <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> isConnected
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h2 id="assignment-3"><a href="#assignment-3" class="header-anchor">#</a> Assignment 3</h2> <h3 id="the-internet-connection-class"><a href="#the-internet-connection-class" class="header-anchor">#</a> The Internet Connection Class</h3> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code><span class="token keyword">package</span> your<span class="token punctuation">.</span>package<span class="token punctuation">.</span>name<span class="token punctuation">.</span>goes<span class="token punctuation">.</span>here

<span class="token keyword">import</span> android<span class="token punctuation">.</span>app<span class="token punctuation">.</span>AlertDialog
<span class="token keyword">import</span> android<span class="token punctuation">.</span>content<span class="token punctuation">.</span>Context
<span class="token keyword">import</span> android<span class="token punctuation">.</span>net<span class="token punctuation">.</span>ConnectivityManager
<span class="token keyword">import</span> android<span class="token punctuation">.</span>net<span class="token punctuation">.</span>NetworkCapabilities
<span class="token keyword">import</span> kotlin<span class="token punctuation">.</span>system<span class="token punctuation">.</span>exitProcess

<span class="token comment">/*
 * Created by Tony Davidson on October 24, 2019
 *
 * requires these permissions:
 *     &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;/&gt;
 *     &lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot;/&gt;
 *
 *  requires these string values in strings.xml
 *     &lt;string name=&quot;message_title&quot;&gt;Network Error&lt;/string&gt;
 *     &lt;string name=&quot;message_text&quot;&gt;This App requires an internet connection&lt;/string&gt;
 *
*/</span>

<span class="token keyword">class</span> <span class="token function">InternetConnected</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">val</span> context<span class="token operator">:</span> Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">fun</span> <span class="token function">checkNetworkConnectivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>
        <span class="token keyword">val</span> connectivityManager <span class="token operator">=</span>
            context<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span>Context<span class="token punctuation">.</span>CONNECTIVITY_SERVICE<span class="token punctuation">)</span> <span class="token keyword">as</span> ConnectivityManager

        <span class="token keyword">return</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>Build<span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">&gt;=</span>  android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>M<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">postMarshmallowInternetCheck</span><span class="token punctuation">(</span>connectivityManager<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">preMarshmallowInternetCheck</span><span class="token punctuation">(</span>connectivityManager<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Before Marshmallow get from activeNetworkInfo in the connectivityManager</span>
    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">preMarshmallowInternetCheck</span><span class="token punctuation">(</span>connectivityManager<span class="token operator">:</span> ConnectivityManager<span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>
        <span class="token keyword">val</span> activeNetwork <span class="token operator">=</span> connectivityManager<span class="token punctuation">.</span>activeNetworkInfo
        <span class="token keyword">if</span> <span class="token punctuation">(</span>activeNetwork <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>activeNetwork<span class="token punctuation">.</span>type <span class="token operator">==</span> ConnectivityManager<span class="token punctuation">.</span>TYPE_WIFI <span class="token operator">||</span>
                    activeNetwork<span class="token punctuation">.</span>type <span class="token operator">==</span> ConnectivityManager<span class="token punctuation">.</span>TYPE_MOBILE<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Marshmallow and up get from activeNetwork of connectivityManager</span>
    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">postMarshmallowInternetCheck</span><span class="token punctuation">(</span>connectivityManager<span class="token operator">:</span> ConnectivityManager<span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>
        <span class="token keyword">val</span> network <span class="token operator">=</span> connectivityManager<span class="token punctuation">.</span>activeNetwork
        <span class="token keyword">val</span> connection <span class="token operator">=</span> connectivityManager<span class="token punctuation">.</span><span class="token function">getNetworkCapabilities</span><span class="token punctuation">(</span>network<span class="token punctuation">)</span>

        <span class="token keyword">return</span> connection <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>connection<span class="token punctuation">.</span><span class="token function">hasTransport</span><span class="token punctuation">(</span>NetworkCapabilities<span class="token punctuation">.</span>TRANSPORT_WIFI<span class="token punctuation">)</span> <span class="token operator">||</span>
                        connection<span class="token punctuation">.</span><span class="token function">hasTransport</span><span class="token punctuation">(</span>NetworkCapabilities<span class="token punctuation">.</span>TRANSPORT_CELLULAR<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fun</span> <span class="token function">outputErrorMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        AlertDialog<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>message_title<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>message_text<span class="token punctuation">)</span>
            <span class="token comment">//.setPositiveButton(R.string.retry)  {_,_ -&gt; }</span>
            <span class="token punctuation">.</span><span class="token function">setNegativeButton</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>quit<span class="token punctuation">)</span> <span class="token punctuation">{</span> _ <span class="token punctuation">,</span> _ <span class="token operator">-&gt;</span>  <span class="token function">exitProcess</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
            <span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><h3 id="theapp-class-with-companion-object"><a href="#theapp-class-with-companion-object" class="header-anchor">#</a> TheApp class with companion object</h3> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code><span class="token keyword">package</span> your<span class="token punctuation">.</span>package<span class="token punctuation">.</span>name<span class="token punctuation">.</span>goes<span class="token punctuation">.</span>here


<span class="token comment">/*
 * Created by Tony Davidson on October 24, 2019
*/</span>

<span class="token keyword">import</span> android<span class="token punctuation">.</span>app<span class="token punctuation">.</span>Application
<span class="token keyword">import</span> android<span class="token punctuation">.</span>content<span class="token punctuation">.</span>Context

<span class="token keyword">class</span> TheApp <span class="token operator">:</span> <span class="token function">Application</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        context <span class="token operator">=</span> applicationContext
    <span class="token punctuation">}</span>

    <span class="token keyword">companion</span> <span class="token keyword">object</span> <span class="token punctuation">{</span>
        <span class="token keyword">lateinit</span> <span class="token keyword">var</span> context<span class="token operator">:</span> Context
            <span class="token keyword">private</span> <span class="token keyword">set</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>Add new tag to the manifest file:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>&lt;application
    android:name=&quot;your.package.name.goes.here.TheApp&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="gestures"><a href="#gestures" class="header-anchor">#</a> Gestures</h3> <p>Modify the Activity to include gesture listeners:</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code><span class="token comment">// Implementing the Listener Class for Gestures and for double tap detection</span>
<span class="token comment">// Also add the GestureDetector.OnDoubleTapListener interface</span>
<span class="token keyword">class</span> MainActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    GestureDetector<span class="token punctuation">.</span>OnGestureListener<span class="token punctuation">,</span> GestureDetector<span class="token punctuation">.</span><span class="token function">OnDoubleTapListener</span>
<span class="token punctuation">{</span>

 <span class="token comment">//...</span>


<span class="token comment">// Declare that the class implements the listener interfaces mandates that the corresponding methods also be implemented in the class:</span>

<span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onDown</span><span class="token punctuation">(</span>event<span class="token operator">:</span> MotionEvent<span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span> <span class="token comment">// This indicates to the Android Framework that the event has been handled</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onFling</span><span class="token punctuation">(</span>event1<span class="token operator">:</span> MotionEvent<span class="token punctuation">,</span> event2<span class="token operator">:</span> MotionEvent<span class="token punctuation">,</span> velocityX<span class="token operator">:</span> Float<span class="token punctuation">,</span>
                         velocityY<span class="token operator">:</span> Float<span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>

   <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onScroll</span><span class="token punctuation">(</span>e1<span class="token operator">:</span> MotionEvent<span class="token punctuation">,</span> e2<span class="token operator">:</span> MotionEvent<span class="token punctuation">,</span> distanceX<span class="token operator">:</span> Float<span class="token punctuation">,</span>
                          distanceY<span class="token operator">:</span> Float<span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onShowPress</span><span class="token punctuation">(</span>event<span class="token operator">:</span> MotionEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onSingleTapUp</span><span class="token punctuation">(</span>event<span class="token operator">:</span> MotionEvent<span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onDoubleTap</span><span class="token punctuation">(</span>event<span class="token operator">:</span> MotionEvent<span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onDoubleTapEvent</span><span class="token punctuation">(</span>event<span class="token operator">:</span> MotionEvent<span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onSingleTapConfirmed</span><span class="token punctuation">(</span>event<span class="token operator">:</span> MotionEvent<span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onLongPress</span><span class="token punctuation">(</span>event<span class="token operator">:</span> MotionEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>


<span class="token comment">// Create the GestureDetectorCompat Instance in MainActivity:</span>
    <span class="token keyword">var</span> gestureDetector<span class="token operator">:</span> GestureDetectorCompat<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>


<span class="token comment">// Add the listener code in onCreate:</span>

        gestureDetector <span class="token operator">=</span> <span class="token function">GestureDetectorCompat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
        gestureDetector<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">setOnDoubleTapListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>


<span class="token comment">//Implementing the onTouchEvent() Method:</span>

<span class="token comment">// Do this in the activity class and implement it so that it calls the</span>
<span class="token comment">// onTouchEvent() method of the GestureDetectorCompat instance.</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onTouchEvent</span><span class="token punctuation">(</span>event<span class="token operator">:</span> MotionEvent<span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>
        gestureDetector<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">onTouchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onTouchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token comment">// Make sure you call the superclass method</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div><h3 id="full-screen"><a href="#full-screen" class="header-anchor">#</a> Full Screen</h3> <p>Android offers three options to making your app full-screen:</p> <ul><li>Lean Back</li> <li>Immersive</li> <li>Immersive Sticky</li></ul> <p>All three approaches hide the system bars however your activity continues to receive all touch events. The difference between them is how the user can bring the system bars back into view.</p> <p>Lean back mode is for full-screen experiences in which users won't be interacting heavily with the screen, such as while watching a video. When users want to bring back the system bars, they simply tap the screen anywhere.</p> <p>Immersive mode is intended for apps in which the user will be heavily interacting with the screen. Examples are games, viewing images in a gallery, or reading paginated content, like a book or slides in a presentation. When users need to bring back the system bars, they swipe from any edge where a system bar is hidden. By requiring this more deliberate gesture, the user's engagement with your app won't be interrupted by accidental touches and swipes.</p> <p>Sticky immersive mode: In the regular immersive mode, any time a user swipes from an edge, the system takes care of revealing the system barsyour app won't even be aware that the gesture occurred. So if the user might actually need to swipe from the edge of the screen as part of the primary app experiencesuch as when playing a game that requires lots of swiping or using a drawing appyou should instead enable the &quot;sticky&quot; immersive mode. While in sticky immersive mode, if the user swipes from an edge with a system bar, system bars appear but they're semi-transparent, and the touch gesture is passed to your app so it app can also respond to the gesture.</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code><span class="token comment">// region hide/show UI</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">hideSystemUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Enables regular immersive mode.</span>
        <span class="token comment">// For &quot;lean back&quot; mode, remove SYSTEM_UI_FLAG_IMMERSIVE.</span>
        <span class="token comment">// Or for &quot;sticky immersive,&quot; replace it with SYSTEM_UI_FLAG_IMMERSIVE_STICKY</span>
        window<span class="token punctuation">.</span>decorView<span class="token punctuation">.</span>systemUiVisibility <span class="token operator">=</span> <span class="token punctuation">(</span>View<span class="token punctuation">.</span>SYSTEM_UI_FLAG_IMMERSIVE
                <span class="token comment">// Set the content to appear under the system bars so that the</span>
                <span class="token comment">// content doesn't resize when the system bars hide and show.</span>
                <span class="token operator">or</span> View<span class="token punctuation">.</span>SYSTEM_UI_FLAG_LAYOUT_STABLE
                <span class="token operator">or</span> View<span class="token punctuation">.</span>SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION
                <span class="token operator">or</span> View<span class="token punctuation">.</span>SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN
                <span class="token comment">// Hide the nav bar and status bar</span>
                <span class="token operator">or</span> View<span class="token punctuation">.</span>SYSTEM_UI_FLAG_HIDE_NAVIGATION
                <span class="token operator">or</span> View<span class="token punctuation">.</span>SYSTEM_UI_FLAG_FULLSCREEN<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Shows the system bars by removing all the flags</span>
    <span class="token comment">// except for the ones that make the content appear under the system bars.</span>
    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">showSystemUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span>decorView<span class="token punctuation">.</span>systemUiVisibility <span class="token operator">=</span> <span class="token punctuation">(</span>View<span class="token punctuation">.</span>SYSTEM_UI_FLAG_LAYOUT_STABLE
                <span class="token operator">or</span> View<span class="token punctuation">.</span>SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION
                <span class="token operator">or</span> View<span class="token punctuation">.</span>SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token comment">// endregion</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="shared-preferences"><a href="#shared-preferences" class="header-anchor">#</a> Shared Preferences</h3> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code><span class="token keyword">package</span> your<span class="token punctuation">.</span>package<span class="token punctuation">.</span>name<span class="token punctuation">.</span>goes<span class="token punctuation">.</span>here

<span class="token comment">/*
 * Created by Tony Davidson on Nov 2, 2019
 *
 *
 * Note: All changes you make in a SharedPreferences editor are batched,
 * they are not copied back to the original SharedPreferences until you call commit() or apply()
 * commit is immediate and can cause blocking
 * apply runs in the background therefore it is non-blocking
 *
 * All modifications to the preferences must go through an Editor object so that the preference
 * values remain in a consistent state and control when they are committed to storage.
 * Objects that are returned from the various get methods must be treated as immutable by the App
 *
*/</span>

<span class="token keyword">import</span> android<span class="token punctuation">.</span>content<span class="token punctuation">.</span>Context
<span class="token keyword">import</span> android<span class="token punctuation">.</span>content<span class="token punctuation">.</span>SharedPreferences

<span class="token keyword">class</span> <span class="token function">SharedPreference</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">val</span> context<span class="token operator">:</span> Context <span class="token operator">=</span> TheApp<span class="token punctuation">.</span>context<span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token comment">// region Properties</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> preferencesName <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>app_name<span class="token punctuation">)</span> <span class="token comment">// use the app name</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> sharedPref<span class="token operator">:</span> SharedPreferences <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getSharedPreferences</span><span class="token punctuation">(</span>preferencesName<span class="token punctuation">,</span>
        Context<span class="token punctuation">.</span>MODE_PRIVATE<span class="token punctuation">)</span>
<span class="token comment">// endregion</span>

<span class="token comment">// region Methods</span>
    <span class="token keyword">fun</span> <span class="token function">contains</span><span class="token punctuation">(</span>KEY_NAME<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> Boolean<span class="token punctuation">{</span>
        <span class="token keyword">return</span> sharedPref<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>KEY_NAME<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fun</span> <span class="token function">removeValue</span><span class="token punctuation">(</span>KEY_NAME<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">val</span> editor<span class="token operator">:</span> SharedPreferences<span class="token punctuation">.</span>Editor <span class="token operator">=</span> sharedPref<span class="token punctuation">.</span><span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        editor<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>KEY_NAME<span class="token punctuation">)</span>
        editor<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fun</span> <span class="token function">clearSharedPreference</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">val</span> editor<span class="token operator">:</span> SharedPreferences<span class="token punctuation">.</span>Editor <span class="token operator">=</span> sharedPref<span class="token punctuation">.</span><span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        editor<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        editor<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fun</span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> sharedPref<span class="token punctuation">.</span>all
    <span class="token punctuation">}</span>

<span class="token comment">// endregion</span>

<span class="token comment">// region Set methods</span>
    <span class="token keyword">fun</span> <span class="token function">save</span><span class="token punctuation">(</span>KEY_NAME<span class="token operator">:</span> String<span class="token punctuation">,</span> text<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">val</span> editor<span class="token operator">:</span> SharedPreferences<span class="token punctuation">.</span>Editor <span class="token operator">=</span> sharedPref<span class="token punctuation">.</span><span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        editor<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span>KEY_NAME<span class="token punctuation">,</span> text<span class="token punctuation">)</span>
        editor<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// **** you need to add set methods for Int, Long, Float, Boolean and Set&lt;String&gt;</span>

<span class="token comment">// endregion</span>

<span class="token comment">// region Get methods</span>
    <span class="token keyword">fun</span> <span class="token function">getValueString</span><span class="token punctuation">(</span>KEY_NAME<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> String<span class="token operator">?</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> sharedPref<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>KEY_NAME<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// **** you need to add get methods for Int?, Long?, Float?, Boolean? and Set&lt;String&gt;?</span>

<span class="token comment">// endregion</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br></div></div><h2 id="assignment-4"><a href="#assignment-4" class="header-anchor">#</a> Assignment 4</h2> <h3 id="update-glideimage-class-to-use-modified-urls-and-diskcachestrategy"><a href="#update-glideimage-class-to-use-modified-urls-and-diskcachestrategy" class="header-anchor">#</a> Update GlideImage class to use modified URLs and DiskCacheStrategy</h3> <p>Modify all 20 URLs as described below:</p> <p>Add 3 new constant properties to GlideImage class above your URLs:</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code>    <span class="token keyword">private</span> <span class="token keyword">val</span> randomSiteIdentifier <span class="token operator">=</span> <span class="token string">&quot;&lt;RANDOM&gt;&quot;</span>  <span class="token comment">// note &lt; and &gt; are illegal URL characters</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> appScreenWidth <span class="token operator">=</span> <span class="token string">&quot;&lt;appscreenwidth&gt;&quot;</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> appScreenHeight <span class="token operator">=</span> <span class="token string">&quot;&lt;appscreenheight&gt;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Now modify your URLs to use these new properties using <code>&lt;RANDOM&gt;</code> at the end of any URLs that link to sites that provide a random image on every https request, replace all width values with <code>&lt;appscreenwidth&gt;</code> and all height values with <code>&lt;appscreenheight&gt;</code> as shown below:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>   &quot;https://loremflickr.com/${appScreenWidth}/${appScreenHeight}$randomSiteIdentifier&quot;
   &quot;https://placebeard.it/${appScreenWidth}x${appScreenHeight}&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Add these three new properties for diskCacheStrategy, width and height under your URLs:</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code>    <span class="token comment">// new properties</span>
    <span class="token keyword">private</span> <span class="token keyword">var</span> diskCacheStrategy <span class="token operator">=</span> DiskCacheStrategy<span class="token punctuation">.</span>NONE
    <span class="token keyword">private</span> <span class="token keyword">var</span> width <span class="token operator">=</span> <span class="token number">300</span>
    <span class="token keyword">private</span> <span class="token keyword">var</span> height <span class="token operator">=</span> <span class="token number">400</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Update loadGlideImage() method with this code just above the actual load ( Glide.with ):</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code>    <span class="token keyword">var</span> updatedUrl <span class="token operator">=</span> url

    <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>randomSiteIdentifier<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        diskCacheStrategy <span class="token operator">=</span> DiskCacheStrategy<span class="token punctuation">.</span>NONE
        updatedUrl <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>randomSiteIdentifier<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        diskCacheStrategy <span class="token operator">=</span> DiskCacheStrategy<span class="token punctuation">.</span>ALL
    <span class="token punctuation">}</span>

    updatedUrl <span class="token operator">=</span> updatedUrl<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>appScreenWidth<span class="token punctuation">,</span> width<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    updatedUrl <span class="token operator">=</span> updatedUrl<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>appScreenHeight<span class="token punctuation">,</span> height<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Modify the Glide.with statement to use these two new properties:</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code>    Glide<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token comment">// our context = the Activity</span>
         <span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>updatedUrl<span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">diskCacheStrategy</span><span class="token punctuation">(</span>diskCacheStrategy<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Modify the rest of the code in Glide.with to use these two new properties:</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code><span class="token punctuation">.</span><span class="token function">listener</span><span class="token punctuation">(</span><span class="token keyword">object</span><span class="token operator">:</span> RequestListener<span class="token operator">&lt;</span>Drawable<span class="token operator">&gt;</span><span class="token punctuation">{</span>
                <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onLoadFailed</span><span class="token punctuation">(</span>
                    e<span class="token operator">:</span> GlideException<span class="token operator">?</span><span class="token punctuation">,</span>
                    model<span class="token operator">:</span> Any<span class="token operator">?</span><span class="token punctuation">,</span>
                    target<span class="token operator">:</span> Target<span class="token operator">&lt;</span>Drawable<span class="token operator">&gt;</span><span class="token operator">?</span><span class="token punctuation">,</span>
                    isFirstResource<span class="token operator">:</span> Boolean
                <span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>
                    progressBar<span class="token punctuation">.</span>visibility <span class="token operator">=</span> View<span class="token punctuation">.</span>GONE
                    context<span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">&quot;Glide Load Failed: <span class="token interpolation variable">$updatedUrl</span>&quot;</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token boolean">false</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onResourceReady</span><span class="token punctuation">(</span>
                    resource<span class="token operator">:</span> Drawable<span class="token operator">?</span><span class="token punctuation">,</span>
                    model<span class="token operator">:</span> Any<span class="token operator">?</span><span class="token punctuation">,</span>
                    target<span class="token operator">:</span> Target<span class="token operator">&lt;</span>Drawable<span class="token operator">&gt;</span><span class="token operator">?</span><span class="token punctuation">,</span>
                    dataSource<span class="token operator">:</span> DataSource<span class="token operator">?</span><span class="token punctuation">,</span>
                    isFirstResource<span class="token operator">:</span> Boolean
                <span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{</span>
                    progressBar<span class="token punctuation">.</span>visibility <span class="token operator">=</span> View<span class="token punctuation">.</span>GONE
                    imageView<span class="token punctuation">.</span><span class="token function">setImageDrawable</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span>

                    lastURL <span class="token operator">=</span> updatedUrl

                    sharedPreference<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>TheApp<span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>last_url_key<span class="token punctuation">)</span><span class="token punctuation">,</span> lastURL<span class="token punctuation">)</span>

                    <span class="token keyword">return</span> <span class="token boolean">false</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span>imageView<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="async-image-cache-delete"><a href="#async-image-cache-delete" class="header-anchor">#</a> Async Image Cache Delete</h3> <p>Add this AsyncTask derived Class inside the GlideImage class as an inner (nested) class:</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code><span class="token comment">//region Nested Async Class and emptyCache method</span>

    <span class="token comment">// new inner async class used to delete existing Glide image cache</span>
    <span class="token comment">// inner classes are similar to static classes however, Kotlin does not support static</span>
    <span class="token comment">// inner classes have access to members of the enclosing class including private members</span>
    <span class="token comment">// inner classes contain a reference to an object of the outer class</span>
    <span class="token keyword">private</span> <span class="token keyword">inner</span> <span class="token keyword">class</span> <span class="token function">AsyncGlide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> AsyncTask<span class="token operator">&lt;</span>Any<span class="token punctuation">,</span> Any<span class="token punctuation">,</span> Any<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">doInBackground</span><span class="token punctuation">(</span><span class="token keyword">vararg</span> p0<span class="token operator">:</span> Any<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> Any<span class="token operator">?</span> <span class="token punctuation">{</span>
            Glide<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>TheApp<span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clearDiskCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onPostExecute</span><span class="token punctuation">(</span>result<span class="token operator">:</span> Any<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onPostExecute</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
            TheApp<span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">&quot;cache deleted&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fun</span> <span class="token function">emptyCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">AsyncGlide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token comment">//endregion</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>Add in MainActivity just after the sharedPreference statement in onCreate():</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code>    <span class="token keyword">val</span> sharedPreference <span class="token operator">=</span> <span class="token function">SharedPreference</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Existing code</span>

    glideImage<span class="token punctuation">.</span><span class="token function">emptyCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// new code</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Also add to onLongPress Gesture in MainActivity:</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onLongPress</span><span class="token punctuation">(</span>event<span class="token operator">:</span> MotionEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        glideImage<span class="token punctuation">.</span><span class="token function">emptyCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="the-displayinfo-class"><a href="#the-displayinfo-class" class="header-anchor">#</a> The DisplayInfo class</h3> <p>Add this class to your project:</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code><span class="token keyword">import</span> android<span class="token punctuation">.</span>content<span class="token punctuation">.</span>Context
<span class="token keyword">import</span> android<span class="token punctuation">.</span>content<span class="token punctuation">.</span>res<span class="token punctuation">.</span>Resources
<span class="token keyword">import</span> android<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span>Point
<span class="token keyword">import</span> android<span class="token punctuation">.</span>util<span class="token punctuation">.</span>DisplayMetrics
<span class="token keyword">import</span> android<span class="token punctuation">.</span>view<span class="token punctuation">.</span>WindowManager

<span class="token comment">/*
 * Created by Tony Davidson on November 10, 2019
*/</span>
<span class="token keyword">class</span> DisplayInfo <span class="token punctuation">{</span>

    <span class="token keyword">var</span> width <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">private</span> <span class="token keyword">set</span>
    <span class="token keyword">var</span> height <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">private</span> <span class="token keyword">set</span>

    <span class="token keyword">var</span> realWidth <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">private</span> <span class="token keyword">set</span>
    <span class="token keyword">var</span> realHeight <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">private</span> <span class="token keyword">set</span>

    <span class="token keyword">var</span> density <span class="token operator">=</span> <span class="token number">0.0f</span>
        <span class="token keyword">private</span> <span class="token keyword">set</span>

    <span class="token keyword">var</span> isPortrait <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">get</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">isOrientationLandscape</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">private</span> <span class="token keyword">set</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">isOrientationLandscape</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> Boolean<span class="token punctuation">{</span>
        <span class="token function">refreshDisplayResolution</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>height <span class="token operator">&gt;</span> width<span class="token punctuation">)</span>  <span class="token comment">// false if landscape</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">refreshDisplayResolution</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token keyword">val</span> displayMetrics<span class="token operator">:</span> DisplayMetrics <span class="token operator">=</span> Resources<span class="token punctuation">.</span><span class="token function">getSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>displayMetrics
        width <span class="token operator">=</span> displayMetrics<span class="token punctuation">.</span>widthPixels
        height <span class="token operator">=</span> displayMetrics<span class="token punctuation">.</span>heightPixels
        density <span class="token operator">=</span> displayMetrics<span class="token punctuation">.</span>density

        <span class="token keyword">val</span> windowManager <span class="token operator">=</span> TheApp<span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span>Context<span class="token punctuation">.</span>WINDOW_SERVICE<span class="token punctuation">)</span> <span class="token keyword">as</span> WindowManager
        <span class="token keyword">val</span> display <span class="token operator">=</span> windowManager<span class="token punctuation">.</span>defaultDisplay
        <span class="token keyword">val</span> size <span class="token operator">=</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        display<span class="token punctuation">.</span><span class="token function">getRealSize</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span> <span class="token comment">// gets real size in pixels</span>
        realWidth <span class="token operator">=</span> size<span class="token punctuation">.</span>x
        realHeight <span class="token operator">=</span> size<span class="token punctuation">.</span>y
    <span class="token punctuation">}</span>

    <span class="token keyword">init</span><span class="token punctuation">{</span>
        <span class="token function">refreshDisplayResolution</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><h3 id="modify-glideimage-class-to-use-the-displayinfo-class-composition"><a href="#modify-glideimage-class-to-use-the-displayinfo-class-composition" class="header-anchor">#</a> Modify GlideImage class to use the DisplayInfo class (composition)</h3> <p>Add an instance property of the DisplayInfo class inside the GlideImage under the width and height properties:</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code>    <span class="token keyword">private</span> <span class="token keyword">val</span> displayInfo <span class="token operator">=</span> <span class="token function">DisplayInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>We need to check orientation every time we load an image so inside the loadGlideImage method under progressbar = Visible add this new line of code:</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code>    progressBar<span class="token punctuation">.</span>visibility <span class="token operator">=</span> View<span class="token punctuation">.</span>VISIBLE <span class="token comment">// existing code</span>

    <span class="token keyword">val</span> portrait <span class="token operator">=</span> displayInfo<span class="token punctuation">.</span>isPortrait <span class="token comment">// new line of code</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Immediately under the code above use the orientation to swap width and height if required and also adjust bandwidth:</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code>    width <span class="token operator">=</span> displayInfo<span class="token punctuation">.</span>realWidth
    height <span class="token operator">=</span> displayInfo<span class="token punctuation">.</span>realHeight

    <span class="token keyword">if</span><span class="token punctuation">(</span>portrait<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// swap width and height because width needs to be the largest when portrait</span>
        width <span class="token operator">=</span> height<span class="token punctuation">.</span><span class="token function">also</span> <span class="token punctuation">{</span> height <span class="token operator">=</span> width <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Reduce bandwidth</span>
    width <span class="token operator">/=</span> <span class="token number">4</span>
    height <span class="token operator">/=</span> <span class="token number">4</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="add-3-new-string-constants"><a href="#add-3-new-string-constants" class="header-anchor">#</a> Add 3 new String constants</h3> <p>Add the following String constants to strings.xml:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>last_image_file_name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>lastImage.jpg<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>save_permission_key<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>SAVE_PERMISSION<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>gallery_folder_name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>RWA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="the-asyncstorageio-class"><a href="#the-asyncstorageio-class" class="header-anchor">#</a> The AsyncStorageIO class</h3> <p>Add this class to your project:</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code><span class="token keyword">import</span> android<span class="token punctuation">.</span>content<span class="token punctuation">.</span>Context
<span class="token keyword">import</span> android<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span>Bitmap
<span class="token keyword">import</span> android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>AsyncTask
<span class="token keyword">import</span> android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>Toast
<span class="token keyword">import</span> ca<span class="token punctuation">.</span>edumedia<span class="token punctuation">.</span>davidst<span class="token punctuation">.</span>assignment2completed<span class="token punctuation">.</span>TheApp<span class="token punctuation">.</span>Companion<span class="token punctuation">.</span>context
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>File
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>FileOutputStream
<span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>Exception


<span class="token comment">/*
 * Created by Tony Davidson on November 13, 2019
*/</span>



<span class="token keyword">class</span> <span class="token function">AsyncStorageIO</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">var</span> bitmap<span class="token operator">:</span> Bitmap<span class="token punctuation">)</span> <span class="token operator">:</span>
    AsyncTask<span class="token operator">&lt;</span>Any<span class="token punctuation">,</span> Any<span class="token punctuation">,</span> Any<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token comment">// region Properties</span>
    <span class="token keyword">var</span> completed <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">private</span> <span class="token keyword">set</span>

    <span class="token keyword">private</span> <span class="token keyword">val</span> fileName <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>last_image_file_name<span class="token punctuation">)</span>

<span class="token comment">// endregion</span>

<span class="token comment">// region Background Method overrides</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onPreExecute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onPreExecute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        completed <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">doInBackground</span><span class="token punctuation">(</span><span class="token keyword">vararg</span> p0<span class="token operator">:</span> Any<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> Any<span class="token operator">?</span> <span class="token punctuation">{</span>
        <span class="token function">saveLastImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onPostExecute</span><span class="token punctuation">(</span>result<span class="token operator">:</span> Any<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onPostExecute</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        completed <span class="token operator">=</span> <span class="token boolean">true</span>
        context<span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">&quot;Saved Last Image&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token comment">// endregion</span>

<span class="token comment">// region Save Last Image to Internal Storage</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">saveLastImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">val</span> file <span class="token operator">=</span> TheApp<span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">getFileStreamPath</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            file<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token function">saveImageToInternalStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">saveImageToInternalStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">val</span> file <span class="token operator">=</span> <span class="token function">File</span><span class="token punctuation">(</span>TheApp<span class="token punctuation">.</span>context<span class="token punctuation">.</span>filesDir<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span>
        <span class="token function">saveImageToStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">saveImageToStream</span><span class="token punctuation">(</span>file<span class="token operator">:</span> File<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">val</span> outputStream <span class="token operator">=</span> <span class="token function">FileOutputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                bitmap<span class="token punctuation">.</span><span class="token function">compress</span><span class="token punctuation">(</span>Bitmap<span class="token punctuation">.</span>CompressFormat<span class="token punctuation">.</span>JPEG<span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> outputStream<span class="token punctuation">)</span>
                outputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                context<span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message <span class="token operator">?:</span> <span class="token string">&quot;Bitmap Compress Error&quot;</span><span class="token punctuation">)</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            context<span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message <span class="token operator">?:</span> <span class="token string">&quot;File Stream Error&quot;</span><span class="token punctuation">)</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token comment">// endregion</span>

<span class="token comment">// region Extension methods</span>
    <span class="token comment">// Extension function to show toast message</span>
    <span class="token keyword">private</span> <span class="token keyword">fun</span> Context<span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span>message<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token comment">// endregion</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br></div></div><h3 id="application-lifecycle-add-onpause-override-to-save-last-image-with-asyncstorageio"><a href="#application-lifecycle-add-onpause-override-to-save-last-image-with-asyncstorageio" class="header-anchor">#</a> Application Lifecycle: Add onPause() override to save last image with AsyncStorageIO</h3> <p>Add an <code>onPause()</code> override in <code>MainActivity</code> then add the code below, immediately after the call to <code>super</code>.<code>onPause()</code>, to save the current image from the <code>imageView</code> control:</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// existing code</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>imageView1<span class="token punctuation">.</span>drawable <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// make sure we have an image!</span>
            <span class="token keyword">val</span> bitmap <span class="token operator">=</span> imageView1<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span><span class="token function">toBitmap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">val</span> asyncStorageIO <span class="token operator">=</span> <span class="token function">AsyncStorageIO</span><span class="token punctuation">(</span>bitmap<span class="token punctuation">)</span>
            asyncStorageIO<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="load-the-last-image-method"><a href="#load-the-last-image-method" class="header-anchor">#</a> Load the last image method</h3> <p>We can use the Glide library to load an image from private storage, this takes care of async etc:</p> <p>Add this method near the end of the GlideImage class, just before the init method:</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code><span class="token comment">// region Load Image from Internal Storage</span>

<span class="token keyword">fun</span> <span class="token function">loadImageFromInternalStorage</span><span class="token punctuation">(</span>
    imageView<span class="token operator">:</span> ImageView<span class="token punctuation">,</span>
    context<span class="token operator">:</span> Context
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> filePath <span class="token operator">=</span> <span class="token string">&quot;<span class="token interpolation"><span class="token delimiter variable">${</span>context<span class="token punctuation">.</span>filesDir<span class="token delimiter variable">}</span></span><span class="token interpolation"><span class="token delimiter variable">${</span>File<span class="token punctuation">.</span>separator<span class="token delimiter variable">}</span></span><span class="token interpolation"><span class="token delimiter variable">${</span>TheApp<span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>last_image_file_name<span class="token punctuation">)</span><span class="token delimiter variable">}</span></span>&quot;</span>
    context<span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span> <span class="token comment">// for testing</span>
    Glide<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token function">File</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">diskCacheStrategy</span><span class="token punctuation">(</span>DiskCacheStrategy<span class="token punctuation">.</span>NONE<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span>imageView<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// endregion</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>To load the the last image we need to modify the load lastURL code at the end of <code>onCreate()</code> in <code>MainActivity</code>:</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code><span class="token comment">// replace the load lastURL code with this new code:</span>

        <span class="token keyword">val</span> fileName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>last_image_file_name<span class="token punctuation">)</span>
        <span class="token keyword">var</span> file <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getFileStreamPath</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//file.delete() // use this for testing only</span>
            glideImage<span class="token punctuation">.</span><span class="token function">loadImageFromInternalStorage</span><span class="token punctuation">(</span>imageView1<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

            <span class="token comment">//sharedPreference.removeValue(R.string.last_url_key.toString())</span>
            <span class="token keyword">val</span> lastUrl<span class="token operator">:</span> String<span class="token operator">?</span> <span class="token operator">=</span> sharedPreference<span class="token punctuation">.</span><span class="token function">getValueString</span><span class="token punctuation">(</span>
                TheApp<span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>last_url_key<span class="token punctuation">)</span>
            <span class="token punctuation">)</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>lastUrl <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                glideImage<span class="token punctuation">.</span><span class="token function">loadGlideImage</span><span class="token punctuation">(</span>imageView1<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> lastUrl<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                glideImage<span class="token punctuation">.</span><span class="token function">loadGlideImage</span><span class="token punctuation">(</span>imageView1<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="modify-asyncstorageio-class-to-support-saving-images-to-the-gallery"><a href="#modify-asyncstorageio-class-to-support-saving-images-to-the-gallery" class="header-anchor">#</a> Modify AsyncStorageIO class to support Saving Images to the gallery</h3> <p>Add the required permissions to the Mainfest file:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.permission.WRITE_EXTERNAL_STORAGE<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.permission.READ_EXTERNAL_STORAGE<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Verify that this String resource exists in strings.xml:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>gallery_folder_name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>RWA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Modify <code>AsyncStorageIO</code> primary constructor by adding a <code>Boolean</code> property:</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code>    <span class="token keyword">class</span> <span class="token function">AsyncStorageIO</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">var</span> bitmap<span class="token operator">:</span> Bitmap<span class="token punctuation">,</span> <span class="token keyword">private</span> <span class="token keyword">val</span> savingLastImage<span class="token operator">:</span> Boolean <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">:</span>
        AsyncTask<span class="token operator">&lt;</span>Any<span class="token punctuation">,</span> Any<span class="token punctuation">,</span> Any<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Modify the <code>onPause()</code> method in <code>MainAvtivity</code> to use the <code>Boolean</code> just added to the <code>AsyncStorageIO</code> primary constructor:</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code><span class="token keyword">if</span><span class="token punctuation">(</span>imageView1<span class="token punctuation">.</span>drawable <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// make sure we have an image!</span>
    <span class="token keyword">val</span> bitmap <span class="token operator">=</span> imageView1<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span><span class="token function">toBitmap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> asyncStorageIO <span class="token operator">=</span> <span class="token function">AsyncStorageIO</span><span class="token punctuation">(</span>bitmap<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// add true argument value here</span>
    asyncStorageIO<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Add a new property to AsyncStorageIO :</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code>    <span class="token keyword">private</span> <span class="token keyword">val</span> folderName <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>gallery_folder_name<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Add the following code and region to AsyncStorageIO for saving images to the photo gallery:</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code><span class="token comment">// region Save Image to Gallery</span>

    <span class="token comment">// for gallery saving</span>
    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">saveImageToPhotoGallery</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>Build<span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">&gt;=</span> android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>Q<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">val</span> values <span class="token operator">=</span> <span class="token function">ContentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>MediaStore<span class="token punctuation">.</span>Images<span class="token punctuation">.</span>Media<span class="token punctuation">.</span>MIME_TYPE<span class="token punctuation">,</span> <span class="token string">&quot;image/jpg&quot;</span><span class="token punctuation">)</span>
            values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>MediaStore<span class="token punctuation">.</span>Images<span class="token punctuation">.</span>Media<span class="token punctuation">.</span>DATE_ADDED<span class="token punctuation">,</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span>
            values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>MediaStore<span class="token punctuation">.</span>Images<span class="token punctuation">.</span>Media<span class="token punctuation">.</span>DATE_TAKEN<span class="token punctuation">,</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>MediaStore<span class="token punctuation">.</span>Images<span class="token punctuation">.</span>Media<span class="token punctuation">.</span>RELATIVE_PATH<span class="token punctuation">,</span> <span class="token string">&quot;Pictures/&quot;</span> <span class="token operator">+</span> folderName<span class="token punctuation">)</span>
            values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>MediaStore<span class="token punctuation">.</span>Images<span class="token punctuation">.</span>Media<span class="token punctuation">.</span>IS_PENDING<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token comment">// Note that RELATIVE_PATH and IS_PENDING are introduced in API 29.</span>

            <span class="token keyword">val</span> uri<span class="token operator">:</span> Uri<span class="token operator">?</span> <span class="token operator">=</span>
                context<span class="token punctuation">.</span>contentResolver<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>MediaStore<span class="token punctuation">.</span>Images<span class="token punctuation">.</span>Media<span class="token punctuation">.</span>EXTERNAL_CONTENT_URI<span class="token punctuation">,</span> values<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>uri <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">saveImageToStream</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>contentResolver<span class="token punctuation">.</span><span class="token function">openOutputStream</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span>
                values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>MediaStore<span class="token punctuation">.</span>Images<span class="token punctuation">.</span>Media<span class="token punctuation">.</span>IS_PENDING<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
                context<span class="token punctuation">.</span>contentResolver<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> values<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// less than Q</span>
            <span class="token keyword">val</span> directory <span class="token operator">=</span> <span class="token function">File</span><span class="token punctuation">(</span>

                Environment<span class="token punctuation">.</span><span class="token function">getExternalStorageDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token operator">+</span> File<span class="token punctuation">.</span>separator <span class="token operator">+</span> folderName
            <span class="token punctuation">)</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>directory<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                directory<span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">val</span> timeStampFileName <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.jpg&quot;</span>

            <span class="token keyword">val</span> file <span class="token operator">=</span> <span class="token function">File</span><span class="token punctuation">(</span>directory<span class="token punctuation">,</span> timeStampFileName<span class="token punctuation">)</span>

            <span class="token function">saveImageToStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>

            <span class="token keyword">val</span> values <span class="token operator">=</span> <span class="token function">ContentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>MediaStore<span class="token punctuation">.</span>Images<span class="token punctuation">.</span>Media<span class="token punctuation">.</span>MIME_TYPE<span class="token punctuation">,</span> <span class="token string">&quot;image/jpg&quot;</span><span class="token punctuation">)</span>
            values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>MediaStore<span class="token punctuation">.</span>Images<span class="token punctuation">.</span>Media<span class="token punctuation">.</span>DATE_ADDED<span class="token punctuation">,</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span>
            values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>MediaStore<span class="token punctuation">.</span>Images<span class="token punctuation">.</span>Media<span class="token punctuation">.</span>DATA<span class="token punctuation">,</span> file<span class="token punctuation">.</span>absolutePath<span class="token punctuation">)</span><span class="token comment">//deprecated API 29</span>

            context<span class="token punctuation">.</span>contentResolver<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>
                MediaStore<span class="token punctuation">.</span>Images<span class="token punctuation">.</span>Media<span class="token punctuation">.</span>EXTERNAL_CONTENT_URI<span class="token punctuation">,</span>
                values
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">saveImageToStream</span><span class="token punctuation">(</span>outputStream<span class="token operator">:</span> OutputStream<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>outputStream <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    bitmap<span class="token punctuation">.</span><span class="token function">compress</span><span class="token punctuation">(</span>Bitmap<span class="token punctuation">.</span>CompressFormat<span class="token punctuation">.</span>JPEG<span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> outputStream<span class="token punctuation">)</span>
                    outputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    TheApp<span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message <span class="token operator">?:</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            context<span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message <span class="token operator">?:</span> <span class="token string">&quot;stream error&quot;</span><span class="token punctuation">)</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token comment">// endregion</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><p>Update the <code>doInBackground()</code> method in <code>AsyncStorageIO</code> so that it calls the correct method: <code>saveLastImage()</code> or <code>saveImage</code>:</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">doInBackground</span><span class="token punctuation">(</span><span class="token keyword">vararg</span> p0<span class="token operator">:</span> Any<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> Any<span class="token operator">?</span> <span class="token punctuation">{</span>
<span class="token comment">//        saveLastImage() // remove these 2 lines of existing code</span>
<span class="token comment">//        return null</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>savingLastImage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">saveLastImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">saveImageToPhotoGallery</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="modify-glideimage-class-for-save-to-photo-gallery-permission"><a href="#modify-glideimage-class-for-save-to-photo-gallery-permission" class="header-anchor">#</a> Modify GlideImage class for save to photo gallery permission</h3> <p>Add two new properties to <code>GlideImage</code> class :</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code><span class="token comment">// new properties</span>
<span class="token keyword">lateinit</span> <span class="token keyword">var</span> asyncStorageIO<span class="token operator">:</span> AsyncStorageIO

<span class="token keyword">var</span> savePermission <span class="token operator">=</span> <span class="token boolean">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Add the following new code (in bold) inside the existing <code>onResourceReady</code> listener in the <code>loadGlideImage</code> method:</p> <div class="language-kt // highlights (Black) for lines 12-18 line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"></div><div class="highlighted"></div><div class="highlighted"></div><div class="highlighted"></div><div class="highlighted"></div><div class="highlighted"></div><div class="highlighted"></div><br><br><br><br><br><br><br><br></div><pre class="language-text"><code>override fun onResourceReady(
    resource: Drawable?,
    model: Any?,
    target: Target&lt;Drawable&gt;?,
    dataSource: DataSource?,
    isFirstResource: Boolean
): Boolean {
    progressBar.visibility = View.GONE
    context.toast(&quot;Glide Load Success&quot;)
    imageView.setImageDrawable(resource) // existing code

// new code
    if (savePermission){ // new code
        val  bitmap = imageView.drawable.toBitmap()
        asyncStorageIO = AsyncStorageIO(bitmap)
        asyncStorageIO.execute()
    }
// end of new code

    lastURL = updatedUrl // existing code
    sharedPreference.save(
        TheApp.context.getString(R.string.last_url_key), lastURL) // could use url

    return false
}
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="adding-runtime-permissions-in-mainactivity"><a href="#adding-runtime-permissions-in-mainactivity" class="header-anchor">#</a> Adding Runtime Permissions in MainActivity</h3> <p>In MainActivity add new property:</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code><span class="token comment">// for runtime permissions, can be any positive int value</span>
    <span class="token keyword">private</span> <span class="token keyword">val</span> REQUEST_CODE <span class="token operator">=</span> <span class="token number">42</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Add the permissions code and region to the Main Activity:</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code><span class="token comment">// region Permissions</span>
    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">setupPermissions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">val</span> permission <span class="token operator">=</span> ContextCompat<span class="token punctuation">.</span><span class="token function">checkSelfPermission</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> Manifest<span class="token punctuation">.</span>permission<span class="token punctuation">.</span>WRITE_EXTERNAL_STORAGE<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>permission <span class="token operator">!=</span> PackageManager<span class="token punctuation">.</span>PERMISSION_GRANTED<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            glideImage<span class="token punctuation">.</span>savePermission <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// need to update in the class</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">&quot;Permission denied!&quot;</span><span class="token punctuation">)</span>
            <span class="token function">makeRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            glideImage<span class="token punctuation">.</span>savePermission <span class="token operator">=</span><span class="token boolean">true</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">&quot;Permission Already Granted...&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">makeRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        ActivityCompat<span class="token punctuation">.</span><span class="token function">requestPermissions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span>Manifest<span class="token punctuation">.</span>permission<span class="token punctuation">.</span>WRITE_EXTERNAL_STORAGE<span class="token punctuation">)</span><span class="token punctuation">,</span> REQUEST_CODE<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onRequestPermissionsResult</span><span class="token punctuation">(</span>
        requestCode<span class="token operator">:</span> Int<span class="token punctuation">,</span>
        permissions<span class="token operator">:</span> Array<span class="token operator">&lt;</span><span class="token keyword">out</span> String<span class="token operator">&gt;</span><span class="token punctuation">,</span>
        grantResults<span class="token operator">:</span> IntArray
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onRequestPermissionsResult</span><span class="token punctuation">(</span>requestCode<span class="token punctuation">,</span> permissions<span class="token punctuation">,</span> grantResults<span class="token punctuation">)</span>

        <span class="token keyword">when</span><span class="token punctuation">(</span>requestCode<span class="token punctuation">)</span><span class="token punctuation">{</span>
            REQUEST_CODE <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>grantResults<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> grantResults<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!=</span> PackageManager<span class="token punctuation">.</span>PERMISSION_GRANTED<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">&quot;Permission denied by user!&quot;</span><span class="token punctuation">)</span>
                    glideImage<span class="token punctuation">.</span>savePermission <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// need to update in the class</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">&quot;Permission granted by user!&quot;</span><span class="token punctuation">)</span>

                    glideImage<span class="token punctuation">.</span>savePermission <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// need to update in the class</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token comment">//endregion</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>In <code>onCreate()</code> add call to <code>setupPermissions()</code> right AFTER checking for an internet connection:</p> <div class="language-kt line-numbers-mode"><pre class="language-kt"><code>    <span class="token function">setupPermissions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/2/2020, 4:45:33 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/F2020/assets/js/app.1cc07ef2.js" defer></script><script src="/F2020/assets/js/2.4b4802b7.js" defer></script><script src="/F2020/assets/js/42.1e48655e.js" defer></script>
  </body>
</html>
